<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>portty portal tester</title>
<style>
  body { font-family: monospace; max-width: 600px; margin: 2em auto; }
  section { margin: 1.5em 0; padding: 1em; border: 1px solid #ccc; }
  h2 { margin-top: 0; }
  button, input[type="file"] { margin: 0.3em 0; }
  pre { background: #f4f4f4; padding: 0.5em; overflow-x: auto; white-space: pre-wrap; }
  .swatch { display: inline-block; width: 2em; height: 2em; vertical-align: middle; border: 1px solid #000; }
</style>
</head>
<body>
<h1>portty portal tester</h1>
<p>Open this in a sandboxed browser (flatpak/snap) that uses xdg-desktop-portal.</p>

<section>
  <h2>FileChooser &mdash; open_file (single)</h2>
  <input type="file" id="pick-single">
  <pre id="out-single">(no selection)</pre>
</section>

<section>
  <h2>FileChooser &mdash; open_file (multiple)</h2>
  <input type="file" id="pick-multi" multiple>
  <pre id="out-multi">(no selection)</pre>
</section>

<section>
  <h2>FileChooser &mdash; open_file (directory)</h2>
  <input type="file" id="pick-dir" webkitdirectory>
  <pre id="out-dir">(no selection)</pre>
</section>

<section>
  <h2>FileChooser &mdash; save_file</h2>
  <button id="btn-save">Save a test file</button>
  <pre id="out-save">(not saved)</pre>
</section>

<section>
  <h2>Screenshot &mdash; pick_color</h2>
  <button id="btn-color">Pick color (EyeDropper API)</button>
  <pre id="out-color">(no color picked)</pre>
  <span class="swatch" id="swatch"></span>
</section>

<script>
function bind(inputId, outId) {
  const input = document.getElementById(inputId);
  const out = document.getElementById(outId);
  input.addEventListener("change", () => {
    const names = Array.from(input.files).map(f => f.name);
    out.textContent = names.length ? names.join("\n") : "(cancelled)";
  });
}

bind("pick-single", "out-single");
bind("pick-multi", "out-multi");
bind("pick-dir", "out-dir");

document.getElementById("btn-save").addEventListener("click", async () => {
  const out = document.getElementById("out-save");
  if (!("showSaveFilePicker" in window)) {
    out.textContent = "File System Access API not available in this browser";
    return;
  }
  try {
    const handle = await showSaveFilePicker({
      suggestedName: "portty-test.txt",
      types: [{ description: "Text files", accept: { "text/plain": [".txt"] } }],
    });
    const writable = await handle.createWritable();
    await writable.write("hello from portty\n");
    await writable.close();
    out.textContent = "saved to: " + handle.name;
  } catch (e) {
    out.textContent = "cancelled or error: " + e.message;
  }
});

document.getElementById("btn-color").addEventListener("click", async () => {
  const out = document.getElementById("out-color");
  const swatch = document.getElementById("swatch");
  if (!("EyeDropper" in window)) {
    out.textContent = "EyeDropper API not available in this browser";
    return;
  }
  try {
    const result = await new EyeDropper().open();
    out.textContent = result.sRGBHex;
    swatch.style.background = result.sRGBHex;
  } catch (e) {
    out.textContent = "cancelled or error: " + e.message;
  }
});
</script>
</body>
</html>
